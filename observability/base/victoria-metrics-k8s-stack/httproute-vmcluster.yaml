---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vmui
  namespace: observability
spec:
  parentRefs:
    - name: platform-private
      namespace: infrastructure
  hostnames:
    - "vmui.priv.${domain_name}"
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      filters:
        - type: RequestRedirect
          requestRedirect:
            hostname: vmselect.priv.${domain_name}
            scheme: https
            path:
              type: ReplaceFullPath
              replaceFullPath: /select/0/vmui # Currently having a unique tenant
            statusCode: 301
    - backendRefs:
        - name: vmselect-victoria-metrics-k8s-stack
          port: 8481
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vminsert
  namespace: observability
spec:
  parentRefs:
    - name: platform-private
      namespace: infrastructure
  hostnames:
    - "vminsert.priv.${domain_name}"
  rules:
    - backendRefs:
        - name: vminsert-victoria-metrics-k8s-stack
          port: 8480
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vmselect
  namespace: observability
spec:
  parentRefs:
    - name: platform-private
      namespace: infrastructure
  hostnames:
    - "vmselect.priv.${domain_name}"
  rules:
    - backendRefs:
        - name: vmselect-victoria-metrics-k8s-stack
          port: 8481
---
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: vmstorage
  namespace: observability
spec:
  parentRefs:
    - name: platform-private
      namespace: infrastructure
  hostnames:
    - "vmstorage.priv.${domain_name}"
  rules:
    - backendRefs:
        - name: vmstorage-victoria-metrics-k8s-stack
          port: 8482
